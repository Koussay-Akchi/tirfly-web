{% extends 'base.html.twig' %}
{% block title %}
	Détails du Voyage
{% endblock %}
{% block body %}

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script type="module">
		import ClimatService from '/js/ClimatService.js';

document.addEventListener('DOMContentLoaded', async () => {
const climatService = new ClimatService();

const weatherDiv = document.getElementById('weather');
const lat = weatherDiv.dataset.lat;
const lon = weatherDiv.dataset.lon;

const temperature = await climatService.getTemperature(lat, lon);

const tempDisplay = document.getElementById('current-temperature');
if (temperature !== null) {
tempDisplay.textContent = `${temperature}°C`;
} else {
tempDisplay.textContent = 'Indisponible';
}
});
	</script>

	<main class="main">
		<div class="voyage-details-details-container">

			<div class="content-box">
				<div>
					<button onclick="window.location.href='{{ path('liste_voyages') }}'" class="btn btn-secondary">← Retour aux voyages</button>
				</div>
				<h1 class="voyage-details-title">
					{{ voyage.nom }}
				</h1>
				<div class="voyage-details-grid-container">
					<div class="voyage-details-grid-image">
						{% if false %}
							<img src="{{ asset(voyage.getImage()) }}" alt="Image du voyage" class="voyage-image">
						{% else %}
							<img src="{{ asset('images/default.jpg') }}" alt="Image par défaut" class="voyage-image"/>
						{% endif %}
					</div>
					<div class="voyage-details-grid-text">
						<div class="voyage-details-details-grid">
							<div>
								<strong>
									Destination :
								</strong>
							</div>
							<div>
								{{ voyage.destination.ville }}
								,
								{{ voyage.destination.pays }}
							</div>
							<div>
								<strong>
									Dates :
								</strong>
							</div>
							<div>
								{{ voyage.dateDepart|date('d/m/Y') }}
								-
								{{ voyage.dateArrive|date('d/m/Y') }}
							</div>
							<div>
								<strong>
									Durée :
								</strong>
							</div>
							<div>
								{{ voyage.dateDepart.diff(voyage.dateArrive).days }}
								jours
							</div>
							<div>
								<strong>
									Formule :
								</strong>
							</div>
							<div>
								{{ voyage.formule }}
							</div>
							<div>
								<strong>
									Note :
								</strong>
							</div>
							<div class="stars">
								{% for i in 1..5 %}
									{% if i <= voyage.note %}
										⭐
									{% elseif i - 0.5 == voyage.note %}
										✬
									{% else %}
										☆
									{% endif %}
								{% endfor %}
							</div>
							<div>
								<strong>
									Météo actuelle :
								</strong>
							</div>
							<div id="weather" data-lat="{{ voyage.destination.latitude }}" data-lon="{{ voyage.destination.longitude }}">
								<span id="current-temperature">Chargement...</span>
							</div>
						</div>
					</div>
				</div>
				<div class="description">
					<div class="price-box">
						<strong>
							Prix :
						</strong>
						<span class="price-value">
							{{ voyage.prix }}
							DT
						</span>
					</div>
					<div>
						{{ voyage.description }}
					</div>
				</div>
				<a href="{{ path('reservation_form', {'id': voyage.id}) }}" class="reserve-button">
					Réserver
				</a>
				<div class="voyage-details-feedback-container">
					<h2>
						Avis des voyageurs
					</h2>
					<form method="post" class="voyage-details-feedback-form">
						<div class="rating-input">
							<label for="note">
								Note :
							</label>
							<div class="star-rating">
								<input type="radio" id="star5" name="note" value="5">
								<label for="star5">
									★
								</label>
								<input type="radio" id="star4" name="note" value="4">
								<label for="star4">
									★
								</label>
								<input type="radio" id="star3" name="note" value="3">
								<label for="star3">
									★
								</label>
								<input type="radio" id="star2" name="note" value="2">
								<label for="star2">
									★
								</label>
								<input type="radio" id="star1" name="note" value="1">
								<label for="star1">
									★
								</label>
							</div>
						</div>
						<label for="comment">
							Avis :
						</label>
						<textarea name="comment" required class="feedback-textarea"></textarea>
						<button type="submit" class="submit-feedback-btn">
							Envoyer
						</button>
					</form>

					<div class="voyage-details-feedback-list">
						{% for feedback in voyage.feedbacks %}
							<div class="voyage-details-feedback-item">
								<div class="feedback-header">
									<strong>
										{{ feedback.client.nom }}
										{{ feedback.client.prenom }}
									</strong>
									<span class="feedback-date">
										{{ feedback.dateFeedback|date('d/m/Y') }}
									</span>
								</div>
								<div class="feedback-rating">
									{% for i in 1..5 %}
										{% if i <= feedback.note %}
											<span class="filled-star">
												★
											</span>
										{% else %}
											<span class="empty-star">
												☆
											</span>
										{% endif %}
									{% endfor %}
								</div>
								<p class="feedback-content">
									{{ feedback.contenu }}
								</p>
							</div>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>
	</main>
{% endblock %}
