{% extends 'base.html.twig' %}

{% block title %}Liste des Voyages
{% endblock %}

{% block body %}


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS (Add just before closing </body> tag) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
	<div class="table-container" style="margin-top: 150px;">
		<h1 class="table-title">Liste des Voyages</h1>
		<div class="table-responsive">
			<table class="voyage-table">
				<thead>
					<tr>
						<th>ID</th>
						<th>Nom</th>
						<th>Destination</th>
						<th>Date Départ</th>
						<th>Date Arrivée</th>
						<th>Prix</th>
						<th>Image</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for voyage in voyages %}
						<tr>
							<td>{{ voyage.id }}</td>
							<td>{{ voyage.nom }}</td>
							<td>{{ voyage.destination.ville }},
								{{ voyage.destination.pays }}</td>
							<td>{{ voyage.dateDepart|date('d/m/Y') }}</td>
							<td>{{ voyage.dateArrive|date('d/m/Y') }}</td>
							<td>{{ voyage.prix }}
								DT</td>
							<td>
								{% if false %}
									<img src="{{ asset('uploads/voyages/' ~ voyage.imageName) }}" alt="Image du voyage" class="table-image">
								{% else %}
									<img src="{{ asset('images/default.jpg') }}" alt="Image par défaut" class="table-image">
								{% endif %}
							</td>
							<td>
								<div class="table-actions">
									<button class="btn btn-primary" onclick="window.location.href='{{ path('edit_voyage', {'id': voyage.id}) }}'">Modifier</button>
									<button class="btn btn-danger" onclick="if(confirm('Supprimer ce voyage ?')) window.location.href='{{ path('delete_voyage', {'id': voyage.id}) }}'">Supprimer</button>
									<button class="btn btn-success" onclick="showFeedbacks({{ voyage.id }})">Voir Feedbacks</button>
								</div>
							</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="8" class="text-center">Aucun voyage trouvé.</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>


			<div class="modal" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="feedbackModalLabel">Feedbacks</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div
							class="modal-body" id="feedbackContent"><!-- Feedbacks will be loaded here dynamically -->
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<script>
    function showFeedbacks(voyageId) {
        fetch('{{ path('admin_voyage_feedbacks', {'id': 'VOYAGE_ID'}) }}'.replace('VOYAGE_ID', voyageId))
            .then(response => response.json())
            .then(data => {
                // Log the feedbacks to the console
                console.log(data.feedbacks);

                let feedbackHtml = '';
                data.feedbacks.forEach(feedback => {
                    feedbackHtml += `<p>${feedback.content}</p>`;
                });
                document.getElementById('feedbackContent').innerHTML = feedbackHtml;
                new bootstrap.Modal(document.getElementById('feedbackModal')).show();
            })
            .catch(error => console.error('Error fetching feedbacks:', error));
    }
</script>


{% endblock %}
